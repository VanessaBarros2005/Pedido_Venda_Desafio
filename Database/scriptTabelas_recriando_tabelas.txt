PRAGMA foreign_keys = OFF;

DROP TABLE IF EXISTS PEDIDOITEM;
DROP TABLE IF EXISTS PEDIDOVENDA;
DROP TABLE IF EXISTS PRODUTO;
DROP TABLE IF EXISTS CLIENTE;
DROP TABLE IF EXISTS CIDADE;
DROP TABLE IF EXISTS ESTADO;

PRAGMA foreign_keys = ON;

CREATE TABLE ESTADO (
    UF CHAR(2) PRIMARY KEY
);

CREATE TABLE CIDADE (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOME VARCHAR(100) NOT NULL,
    UF CHAR(2) NOT NULL,
    FOREIGN KEY (UF) REFERENCES ESTADO(UF) ON DELETE CASCADE
);

CREATE TABLE CLIENTE (
    CODIGO INTEGER PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    UF CHAR(2) NOT NULL,
    CIDADE VARCHAR(100) NOT NULL,
    FOREIGN KEY (UF) REFERENCES ESTADO(UF) ON DELETE CASCADE
);

CREATE TABLE PRODUTO (
    CODIGO INTEGER PRIMARY KEY,
    DESCRICAO VARCHAR(200) NOT NULL,
    PRECOVENDA NUMERIC(10,2) NOT NULL
);

CREATE TABLE PEDIDOVENDA (
    CODIGO INTEGER PRIMARY KEY,
    DATAEMISSAO DATETIME NOT NULL,
    CODIGO_CLIENTE INTEGER NOT NULL,
    VALORTOTAL NUMERIC(10,2) NOT NULL,
    FOREIGN KEY (CODIGO_CLIENTE) REFERENCES CLIENTE(CODIGO) ON DELETE CASCADE
);

CREATE TABLE PEDIDOITEM (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    CODIGO_PEDIDOVENDA INTEGER NOT NULL,
    CODIGO_PRODUTO INTEGER NOT NULL,
    QUANTIDADE NUMERIC NOT NULL,
    VALORUNITARIO NUMERIC NOT NULL,
    VALORTOTAL NUMERIC NOT NULL,
    FOREIGN KEY (CODIGO_PEDIDOVENDA) REFERENCES PEDIDOVENDA(CODIGO) ON DELETE CASCADE,
    FOREIGN KEY (CODIGO_PRODUTO) REFERENCES PRODUTO(CODIGO) ON DELETE CASCADE
);
